{{- $now := .Page.Date }}
{{- $targetMonth := $now.Month }}
{{- $targetDay := $now.Day }}
{{- $tolerance := .Get "plus-minus-days" | default "5" | int }}

{{- $menus := site.GetPage "recipes/menus" }}

<div class="this-weeks-menus">
  {{- range $menus.Pages }}
    {{- $menuDate := .Date }}
    {{- if eq $menuDate.Month $targetMonth }}
      {{- $dayDiff := math.Abs (sub $menuDate.Day $targetDay) }}
      {{- if le $dayDiff $tolerance }}
        <a href="{{ .RelPermalink }}" class="menu-card">
          <!--div class="menu-title">{{ .Title }}</div-->
          {{- $dateFormatted := .Date | time | dateFormat "January 2, 2006" -}}
          {{- $title := .Title -}}
          {{- $rawDate := .Date | time.Format "2006-01-02" -}}
          {{- $rest := replace $title (print $rawDate " ") "" -}}

          <div class="menu-title">{{ $dateFormatted }} - {{ $rest }}</div>

          {{- $headers := findRE `(?m)^###\s+(.+)` .RawContent }}
          {{- $cleaned := slice }}
          {{- range $headers }}
            {{- $line := trim (replace (replace . "###" "") "\\" "") " " }}
            {{- if ne $line "" }}
              {{- $cleaned = $cleaned | append $line }}
            {{- end }}
          {{- end }}
          {{- if gt (len $cleaned) 0 }}
            <div class="menu-items">
              {{ delimit $cleaned ", " }}
            </div>
          {{- end }}
        </a>
      {{- end }}
    {{- end }}
  {{- end }}
</div>

<style>
.this-weeks-menus {
  display: grid;
  gap: 1rem;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
}

.menu-card {
  display: block;
  background-color: var(--code-bg);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  color: var(--secondary);
  padding: 1rem;
  text-decoration: none;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
  box-shadow: none; /* << no base shadow */
}

.menu-card:hover {
  transform: scale(0.98);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06); /* subtle and symmetrical */
}

.menu-title {
  font-weight: 600;
  color: var(--primary);
  margin-bottom: 0.5rem;
  font-size: 1.1rem;
}

.menu-items {
  font-size: 1rem;
  color: var(--secondary);
}

.this-weeks-menus a {
  box-shadow: none !important;
  text-decoration: none;
  color: inherit;
}

</style>

