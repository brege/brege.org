<style>

  .form-margin {
    margin: 1em 1em 4em 1em;
  }

  .search-form input {
    flex: 1;
    height: 2.5rem;
    padding: 0 0.5rem 0 2.5rem;
    border: 1px solid #ccc;
    border-radius: 4px;
    position: relative;
    background-color: #f8f8f8;
    font-size: 1rem;
    transition: background-color 0.2s ease-in-out;
  }

  .search-form input::before {
    content: "\f002";
    font-family: "Font Awesome 5 Free";
    font-weight: 900;
    font-size: 1.25rem;
    position: absolute;
    left: 0.5rem;
  }

  .search-form input:hover {
    background-color: #EBF4FB;
  }

  .result-box {
    display: inline-block;
    border: 2px solid #2196F3; /* Light Blue 500 */
    margin: 4px;
    padding: 4px 8px;
    background-color: #BBDEFB; /* Light Blue 100 */
    color: #0D47A1; /* Light Blue 900 */
    border-radius: 3px;
    font-weight: 600;
  }
   
  .result-box:hover {
    color: #272935; 
    background-color: #64B5F6; /* Light Blue 300 */
  }

  .dark .result-box {
    color: #272935; 
    background-color: #90CAF9; /* Light Blue 200 */
  }

  .dark .result-box:hover {
    background-color: #1976D2; /* Light Blue 700 */
  }

  .search-result {
    list-style: none;
    background-color: #f8f8f8;
    padding: 4px 8px;
    margin: 0;
    cursor: pointer;
  }

  .dark .search-result {
    background-color: #323440; /* dark grey */
  }


  .search-result:hover {
    background-color: #eaeaea; /* light grey */
  }

  .dark .search-result:hover {
    background-color: #444750; /* dark grey */
  }

</style>

{{ $jsonPath := .Get "jsonPath" }}

<div class="form-margin">
  <form id="search-form" onsubmit="return false;">
     <input type="text" name="search" id="search-input" class="form-control bg-highlight-color-7-10" placeholder="Search..." autofocus autocomplete="off">
     <i class="" id="search-icon"></i>
  </form>
  <div id="search-results"></div>
</div>

<script>
  // Get a reference to the search form and input field
  const searchForm = document.getElementById('search-form');
  const searchInput = document.getElementById('search-input');
  const searchResults = document.getElementById('search-results');

  // Add an input event listener to the input field
  searchInput.addEventListener('input', event => {
    const query = searchInput.value;
    // Check if the input field is empty
    if (query.length === 0) {
      // Clear the search results
      searchResults.innerHTML = '';
      return;
    }
    // Perform the search and display the results
    searchJSON(query, '{{ $jsonPath }}');
  });
    
  // Add a focus event listener to the input field
  searchInput.addEventListener('focus', event => {
    const query = searchInput.value;
    searchInput.value = '';
  });

  async function searchJSON(query, jsonPath) {
    const response = await fetch(jsonPath);
    const json = await response.json();
    const results = json.filter(node => node.id.toLowerCase().includes(query.toLowerCase())).slice(0, 5);
  
    // Display the search results as a list of ID's
    searchResults.innerHTML = `
      <ul style="width: ${searchInput.offsetWidth}px">
        ${results.map(result => `<li class="search-result" onclick="handleResultClick('${result.id}')">${result.id}</li>`).join('')}
      </ul>
    `;
  }

  let selectedResults = [];

  // Add a click event listener to the search results
  function handleResultClick(resultId) {
    // Update the search input value
    searchInput.value = resultId;

    // Check if the resultId is in the selectedResults array
    if (!selectedResults.includes(resultId)) {
      // Add the resultId to the selectedResults array
      selectedResults.push(resultId);
      // Create a new element to display the result
      const resultBox = document.createElement('div');
      resultBox.innerHTML = resultId;
      resultBox.classList.add('result-box');
      // Add an event listener to remove the result box when clicked
      resultBox.addEventListener('click', event => {
        resultBox.parentNode.removeChild(resultBox);
        selectedResults = selectedResults.filter(id => id !== resultId);
        // Print the selected results to the console
        console.log(selectedResults);
        // Pass the selelected results to the filterNodesAndEdges function  
        filterNodesAndEdges(selectedResults);

      });
      // Insert the result box before the search form
      searchForm.parentNode.insertBefore(resultBox, searchForm);
    } else {
      // Remove the resultId from the selectedResults array
      selectedResults = selectedResults.filter(id => id !== resultId);
      // Remove the result box from the DOM
      document.querySelectorAll('.result-box').forEach(resultBox => {
        if (resultBox.innerHTML === resultId) {
          resultBox.parentNode.removeChild(resultBox);
        }
      });
    }

    // If selectedResults is updated, filter the nodes and edges
    filterNodesAndEdges(selectedResults);

    // Clear the search results
    searchResults.innerHTML = '';
    // Clear the search input value
    searchInput.value = '';

    // Hide the search results when current search is empty
    if (selectedResults.length === 0) {
      searchResults.style.display = 'none';
    } else {
      searchResults.style.display = 'block';
    }
    

  }

</script>
